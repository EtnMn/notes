<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Les modules :: Notes</title>
    <link rel="canonical" href="https://menou.fr/notes/component-workshop-terraform/main/advanced-terraform/modules.html">
    <link rel="prev" href="existing-resources.html">
    <meta name="description" content="CrÃ©ation de packages autonomes de configuration.">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <img class="navbar-item" src="../../../_/img/logo.png" alt="logo" width="32" height="32">
      <a class="navbar-item" href="https://menou.fr/notes">Notes</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Rechercher">
        </div>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/EtnMn">
          <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" aria-labelledby="title" aria-describedby="desc" role="img" xmlns:xlink="http://www.w3.org/1999/xlink">
              <title>My Github</title>
              <path data-name="layer2" d="M32 0a32.021 32.021 0 0 0-10.1 62.4c1.6.3 2.2-.7 2.2-1.5v-6c-8.9 1.9-10.8-3.8-10.8-3.8-1.5-3.7-3.6-4.7-3.6-4.7-2.9-2 .2-1.9.2-1.9 3.2.2 4.9 3.3 4.9 3.3 2.9 4.9 7.5 3.5 9.3 2.7a6.93 6.93 0 0 1 2-4.3c-7.1-.8-14.6-3.6-14.6-15.8a12.27 12.27 0 0 1 3.3-8.6 11.965 11.965 0 0 1 .3-8.5s2.7-.9 8.8 3.3a30.873 30.873 0 0 1 8-1.1 30.292 30.292 0 0 1 8 1.1c6.1-4.1 8.8-3.3 8.8-3.3a11.965 11.965 0 0 1 .3 8.5 12.1 12.1 0 0 1 3.3 8.6c0 12.3-7.5 15-14.6 15.8a7.746 7.746 0 0 1 2.2 5.9v8.8c0 .9.6 1.8 2.2 1.5A32.021 32.021 0 0 0 32 0z" fill="#FFF"></path>
              <path data-name="layer1" d="M12.1 45.9c-.1.2-.3.2-.5.1s-.4-.3-.3-.5.3-.2.6-.1c.2.2.3.4.2.5zm1.3 1.5a.589.589 0 0 1-.8-.8.631.631 0 0 1 .7.1.494.494 0 0 1 .1.7zm1.3 1.8a.585.585 0 0 1-.7-.3.6.6 0 0 1 0-.8.585.585 0 0 1 .7.3c.2.3.2.7 0 .8zm1.7 1.8c-.2.2-.5.1-.8-.1-.3-.3-.4-.6-.2-.8a.619.619 0 0 1 .8.1.554.554 0 0 1 .2.8zm2.4 1c-.1.3-.4.4-.8.3s-.6-.4-.5-.7.4-.4.8-.3c.3.2.6.5.5.7zm2.6.2c0 .3-.3.5-.7.5s-.7-.2-.7-.5.3-.5.7-.5c.4.1.7.3.7.5zm2.4-.4q0 .45-.6.6a.691.691 0 0 1-.8-.3q0-.45.6-.6c.5-.1.8.1.8.3z" fill="#FFF"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="component-workshop-terraform" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../terraform-intro.html">Workshop Terraform</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../terraform-intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../setup.html">Mise en place</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../create-resources.html">CrÃ©er des ressources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="backend.html">Backend</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="existing-resources.html">Ressources existantes</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="modules.html">Les modules</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Workshop Terraform</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../terraform-intro.html">Workshop Terraform</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../terraform-intro.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../terraform-intro.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../terraform-intro.html">Workshop Terraform</a></li>
    <li><a href="modules.html">Les modules</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/EtnMn/workshop-terraform/edit/main/docs/modules/advanced-terraform/pages/modules.adoc">Ã‰diter</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Les modules</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Les modules <em>Terraform</em> sont des abstractions autonomes de la configuration, permettant d&#8217;organiser son code et de le rÃ©utiliser. Un module est une collection de fichiers <code>.tf</code>, rassemblÃ©s dans un mÃªme rÃ©pertoire. Toutes les configurations disposent d&#8217;au <strong>moins un module</strong>, appelÃ© <em>root</em> et constituÃ© des fichiers <code>.tf</code> prÃ©sents dans le rÃ©pertoire principal. Les modules peuvent peuvent appeler des modules enfants, afin d&#8217;inclure leurs ressources dans la configuration. Les modules enfants peuvent Ãªtre appelÃ©s plusieurs fois dans une mÃªme configuration et plusieurs configurations peuvent appeler les mÃªmes modules.</p>
</div>
<div class="paragraph">
<p>Les modules peuvent Ãªtre chargÃ©s depuis les fichiers locaux, mais Ã©galement depuis un <em>registry</em> privÃ© ou <a href="https://registry.terraform.io/browse/modules">public</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="structure-dun-module"><a class="anchor" href="#structure-dun-module"></a>Structure d&#8217;un module</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Exemple de structure d&#8217;un module</div>
<div class="content">
<pre>ðŸ“’ my-module
  ðŸ“„ LICENSE
  ðŸ“„ README.md
  ðŸ“„ main.tf
  ðŸ“„ variables.tf
  ðŸ“„ outputs.tf</pre>
</div>
</div>
<div class="paragraph">
<p>Il est possible de crÃ©er un module avec seulement un seul fichier <code>.tf</code> mais il est important de ne pas distribuer les fichiers suivants :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>terraform.tfstate</code>, <code>terraform.tfstate.backup</code>: <em>state</em> terraform</p>
</li>
<li>
<p><code>.terraform</code>: contient les plugins</p>
</li>
<li>
<p><code>*.tfvars</code>: variables</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="outputs"><a class="anchor" href="#outputs"></a>Outputs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les <em>Outputs</em> sont les <a href="../create-resources.html#les-variables" class="xref page">variables</a> de sortie d&#8217;un module. Elles ont plusieurs cas d&#8217;utilisations :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un module enfant peut utiliser les <em>outputs</em> pour exposer des attributs de ses ressources Ã  son module parent</p>
</li>
<li>
<p>Le module racine peut utiliser les <em>outputs</em> pour afficher des informations dans la <em>CLI</em>, Ã  l&#8217;issue du <code>terraform apply</code></p>
</li>
<li>
<p>Dans le cas des dÃ©pÃ´ts distants, une configuration peut accÃ©der aux <em>outputs</em> d&#8217;un module <em>root</em> d&#8217;une autre configuration via le <a href="existing-resources.html#data-source" class="xref page">data source</a> <code>terraform_remote_state</code>. Il est ainsi possible de partager de l&#8217;information entre les configurations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pour dÃ©finir une variable de sortie, on utilise le mot clÃ© <code>output</code> :</p>
</div>
<div class="listingblock">
<div class="title">output.tf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-terraform hljs" data-lang="terraform">output "azurerm_storage_account_name" {
  value       = azurerm_storage_account.storage-blob.name <i class="conum" data-value="1"></i><b>(1)</b>
  description = "The Azure Blob storage account name."
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Le nom du <em>storage account</em> est exposÃ© via la variable <code>azurerm_storage_account_name</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour faire rÃ©fÃ©rence Ã  un variable de sortie, il faut utiliser la syntaxe: <code>module.&lt;nom-du-module&gt;.&lt;nom-output&gt;</code></p>
</div>
<div class="listingblock">
<div class="title">main.tf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-terraform hljs" data-lang="terraform">module "application" {
  source           = "./modules/app-service"
  resource_group   = azurerm_resource_group.main.name
  application_name = var.application_name
  environment      = local.environment
  location         = var.location

  azure_storage_account_name  = module.storage-blob.azurerm_storage_account_name <i class="conum" data-value="1"></i><b>(1)</b>
}

module "storage-blob" { <i class="conum" data-value="2"></i><b>(2)</b>
  source           = "./modules/storage-blob" <i class="conum" data-value="3"></i><b>(3)</b>
  resource_group   = azurerm_resource_group.main.name
  application_name = var.application_name
  environment      = local.environment
  location         = var.location
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nom du module cible</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Chemin relatif du module</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>RÃ©cupÃ©ration de la valeur de la variable de sortie</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tÃ©lÃ©chargement-depuis-github"><a class="anchor" href="#tÃ©lÃ©chargement-depuis-github"></a>TÃ©lÃ©chargement depuis GitHub</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un module peut Ãªtre tÃ©lÃ©chargÃ© depuis une <em>repo GitHub</em></p>
</div>
<div class="listingblock">
<div class="title">Via protocole HTTPS</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-terraform hljs" data-lang="terraform">module "mon_module" {
    source = "github.com/hajdaini/example"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Via protocole SSH</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-terraform hljs" data-lang="terraform">module "mon_module" {
    source = "git@github.com:hajdaini/example.git"
}</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="existing-resources.html">Ressources existantes</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
