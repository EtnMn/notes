<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mise en place :: Notes</title>
    <link rel="canonical" href="https://menou.fr/notes/component-workshop-terraform/main/setup.html">
    <link rel="prev" href="terraform-intro.html">
    <link rel="next" href="create-resources.html">
    <meta name="description" content="Installation des outils nécessaires à l'utilisation Terraform sous Windows.">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <img class="navbar-item" src="../../_/img/logo.png" alt="logo" width="32" height="32">
      <a class="navbar-item" href="https://menou.fr/notes">Notes</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Rechercher">
        </div>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/EtnMn">
          <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" aria-labelledby="title" aria-describedby="desc" role="img" xmlns:xlink="http://www.w3.org/1999/xlink">
              <title>My Github</title>
              <path data-name="layer2" d="M32 0a32.021 32.021 0 0 0-10.1 62.4c1.6.3 2.2-.7 2.2-1.5v-6c-8.9 1.9-10.8-3.8-10.8-3.8-1.5-3.7-3.6-4.7-3.6-4.7-2.9-2 .2-1.9.2-1.9 3.2.2 4.9 3.3 4.9 3.3 2.9 4.9 7.5 3.5 9.3 2.7a6.93 6.93 0 0 1 2-4.3c-7.1-.8-14.6-3.6-14.6-15.8a12.27 12.27 0 0 1 3.3-8.6 11.965 11.965 0 0 1 .3-8.5s2.7-.9 8.8 3.3a30.873 30.873 0 0 1 8-1.1 30.292 30.292 0 0 1 8 1.1c6.1-4.1 8.8-3.3 8.8-3.3a11.965 11.965 0 0 1 .3 8.5 12.1 12.1 0 0 1 3.3 8.6c0 12.3-7.5 15-14.6 15.8a7.746 7.746 0 0 1 2.2 5.9v8.8c0 .9.6 1.8 2.2 1.5A32.021 32.021 0 0 0 32 0z" fill="#FFF"></path>
              <path data-name="layer1" d="M12.1 45.9c-.1.2-.3.2-.5.1s-.4-.3-.3-.5.3-.2.6-.1c.2.2.3.4.2.5zm1.3 1.5a.589.589 0 0 1-.8-.8.631.631 0 0 1 .7.1.494.494 0 0 1 .1.7zm1.3 1.8a.585.585 0 0 1-.7-.3.6.6 0 0 1 0-.8.585.585 0 0 1 .7.3c.2.3.2.7 0 .8zm1.7 1.8c-.2.2-.5.1-.8-.1-.3-.3-.4-.6-.2-.8a.619.619 0 0 1 .8.1.554.554 0 0 1 .2.8zm2.4 1c-.1.3-.4.4-.8.3s-.6-.4-.5-.7.4-.4.8-.3c.3.2.6.5.5.7zm2.6.2c0 .3-.3.5-.7.5s-.7-.2-.7-.5.3-.5.7-.5c.4.1.7.3.7.5zm2.4-.4q0 .45-.6.6a.691.691 0 0 1-.8-.3q0-.45.6-.6c.5-.1.8.1.8.3z" fill="#FFF"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="component-workshop-terraform" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="terraform-intro.html">Workshop Terraform</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="terraform-intro.html">Introduction</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="setup.html">Mise en place</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="create-resources.html">Créer des ressources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="advanced-terraform/backend.html">Backend</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="advanced-terraform/existing-resources.html">Ressources existantes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="advanced-terraform/modules.html">Les modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ci-cd/connect-remote-backend.html">Connecter GitHub au backend</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ci-cd/automate.html">Automatiser</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Workshop Terraform</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="terraform-intro.html">Workshop Terraform</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="terraform-intro.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="terraform-intro.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="terraform-intro.html">Workshop Terraform</a></li>
    <li><a href="setup.html">Mise en place</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/EtnMn/workshop-terraform/edit/main/docs/modules/ROOT/pages/setup.adoc">Éditer</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Mise en place</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Dans un environnement <em>Windows</em>, il est possible d&#8217;utiliser <em>Terraform</em> de différentes façons. La plus simple est de passer par <a href="https://docs.microsoft.com/fr-fr/azure/developer/terraform/get-started-cloud-shell-bash?tabs=bash">Azure Cloud Shell</a>, qui ne nécessite pas de prérequis en dehors du compte <em>Azure</em>. Il est également possible de faire une installation manuelle, d&#8217;utiliser une image <em>Docker</em>, <a href="https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/azure-get-started#install-terraform">Chocolatey</a>, ou de passer par <em>Windows Subsystem for Linux</em> (<strong>WSL</strong>). Cette dernière méthode a pour avantage d&#8217;être rapide, performante et de permettre l&#8217;utilisation des applications Windows en parallèle des outils en ligne de commande <em>Linux</em> sur le même ensemble de fichiers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prérequis"><a class="anchor" href="#prérequis"></a>Prérequis</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><em>Windows 10</em> versions 2004 et ultérieures</p>
</li>
<li>
<p><em>VS Code</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="wsl"><a class="anchor" href="#wsl"></a>WSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le Sous-système Windows pour Linux permet d&#8217;exécuter un environnement GNU/Linux (et notamment la plupart des utilitaires, applications et outils en ligne de commande) directement sur Windows, sans modification et tout en évitant la surcharge d&#8217;une machine virtuelle traditionnelle. La version WSL 2 embarque un véritable noyau Linux s&#8217;exécutant dans une machine virtuelle légère.</p>
</div>
<div class="literalblock">
<div class="title">Installation des prérequis et d&#8217;une distribution Ubuntu</div>
<div class="content">
<pre>$ wsl --install</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Vérification de l&#8217;installation</div>
<div class="content">
<pre>$ wsl -l -v</pre>
</div>
</div>
<div class="paragraph">
<p>La version 2 de <em>WSL</em> est à privilégier car <a href="https://docs.microsoft.com/fr-fr/windows/wsl/compare-versions">plus performante</a>.</p>
</div>
<div class="literalblock">
<div class="title">Installer une nouvelle distribution</div>
<div class="content">
<pre>$ wsl --install -d &lt;distribution&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Assigner la distribution par défaut</div>
<div class="content">
<pre>$ wsl --set-default &lt;distribution&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>A l&#8217;issue de l&#8217;installation, il faut renseigner les informations du compte utilisateur de la distribution.</p>
</div>
<div class="literalblock">
<div class="title">Exécuter la distribution par défaut</div>
<div class="content">
<pre>$ wsl</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Il est possible d&#8217;accéder rapidement aux fichiers de la distribution <em>WSL</em> courante, en tapant <code>\\wsl$</code> dans l&#8217;explorateur <em>Windows</em>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="azure-cli"><a class="anchor" href="#azure-cli"></a>Azure CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Azure CLI</em> est une interface en ligne de commande multiplateforme permettant de se connecter à Azure et d’exécuter des commandes d’administration sur les ressources Azure. Elle est installée Azure CLI localement. Même si elle est déjà installé sur le poste, il est préférable de faire également <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-linux?pivots=apt">l&#8217;installation</a> pour l&#8217;environnement <em>WSL</em>.</p>
</div>
<div class="literalblock">
<div class="title">Installation d'<em>Azure CLI</em> pour <em>Ubuntu</em></div>
<div class="content">
<pre>$ curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installer-terraform"><a class="anchor" href="#installer-terraform"></a>Installer Terraform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les packages <em>Ubuntu</em> sont disponibles sur les serveurs <em>HashiCorp</em>. Depuis une fenêtre de commande <em>WSL</em>, exécuter les commandes suivantes :</p>
</div>
<div class="literalblock">
<div class="title">Ajout du repository HashiCorp</div>
<div class="content">
<pre>$ sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Ajout de la clé HashiCorp</div>
<div class="content">
<pre>$ curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Mise à jour du dépôt de packages</div>
<div class="content">
<pre>$ sudo apt-get update</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Installation de Terraform</div>
<div class="content">
<pre>$ sudo apt-get install terraform</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Vérifier l&#8217;installation</div>
<div class="content">
<pre>$ terraform -v</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vs-code"><a class="anchor" href="#vs-code"></a>VS Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Avec <strong>Visual Studio Code</strong> installé et depuis une sessions <em>WSL</em>, exécuter la commande <code>code .</code> pour démarrer l&#8217;installation de <em>VS Code Server</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
En l&#8217;absence d&#8217;éditeur de code, il est possible d&#8217;utiliser l&#8217;éditeur en ligne <em>Github</em> en appuyant sur la touche <kbd>.</kbd> depuis le repo.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour pouvoir développer avec <em>VS Code</em> dans <em>WSL</em>, il faut installer l&#8217;extension <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl">Remote - WSL</a>. La barre de statut de <em>VS Code</em> indique ensuite en bas à gauche que l&#8217;exécution s&#8217;effectue dans <em>WSL</em>: <code>WSL : Ubuntu</code>.</p>
</div>
<div class="paragraph">
<p>L&#8217;extension <em>VS Code</em> <a href="https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform">HashiCorp Terraform</a> n&#8217;est pas obligatoire, mais permet d&#8217;ajouter des fonctionnalités utiles, telles que : la coloration du code, l&#8217;IntelliSense&#8230;&#8203;</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="MISE EN GARDE"></i>
</td>
<td class="content">
J&#8217;ai rencontré des soucis à l&#8217;utilisation de l&#8217;extension <em>Terraform</em>, il arrivait que le binaire <em>Linux</em> soit remplacé par une <em>exe</em>. Pour éviter cela, il faut installer l&#8217;extension via l&#8217;option <code>Install in WSL: Ubuntu (Do not sync)</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentification-azure"><a class="anchor" href="#authentification-azure"></a>Authentification Azure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quand <em>Terraform</em> est exécuté localement, il est nécessaire de lui octroyer l&#8217;autorisation de manipuler les ressources <em>Azure</em> en s&#8217;identifiant.</p>
</div>
<div class="literalblock">
<div class="title">Se connecter avec Azure CLI</div>
<div class="content">
<pre>$ az login</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Lister les subscriptions disponibles</div>
<div class="content">
<pre>$ az account list -o table</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Spécifier la subscription par défaut</div>
<div class="content">
<pre>$ az account set --subscription &lt;subscription id&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Quand Terraform s&#8217;exécute sur un server d&#8217;intégration, l&#8217;authentification est réalisé par un <em>Service Principal</em> ou une identité managée.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
L&#8217;authentification est implicite lorsque l&#8217;on utilise le <em>Cloud Shell</em>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="git"><a class="anchor" href="#git"></a>Git</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comme pour tous les types de projets, certains fichiers ne doivent pas être gérés en configuration. Le plus simple est d&#8217;utiliser le <a href="https://github.com/github/gitignore/blob/main/Terraform.gitignore">git ignore</a> proposé.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="terraform-intro.html">Introduction</a></span>
  <span class="next"><a href="create-resources.html">Créer des ressources</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
